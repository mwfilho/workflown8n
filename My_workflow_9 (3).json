{
  "name": "My workflow 9",
  "nodes": [
    {
      "parameters": {
        "content": "## ü§ñ AI Agent Jur√≠dico PDPJ\n\n### Funcionalidades:\n- üí¨ Chat interativo com mem√≥ria\n- üîê Login autom√°tico no PJE\n- üìã Consulta de processos\n- üìÑ Download de documentos\n- üß† An√°lise inteligente com IA\n- üìä Gera√ß√£o de relat√≥rios\n\n### Tools Dispon√≠veis:\n1. **Login Tool** - Autentica no PJE\n2. **Consulta Processo** - Busca dados do processo\n3. **Listar Documentos** - Lista documentos dispon√≠veis\n4. **Analisar Processo** - Gera insights jur√≠dicos\n5. **Buscar Jurisprud√™ncia** - Pesquisa casos similares",
        "height": 400,
        "width": 350
      },
      "id": "41294301-5d19-4445-aa48-ea87a561c112",
      "name": "Documenta√ß√£o",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -40,
        80
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "public": true,
        "options": {
          "responseMode": "responseNode"
        }
      },
      "id": "d2ae80d3-ff49-4f6c-927e-5c5dc219beb2",
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "position": [
        380,
        260
      ],
      "typeVersion": 1.1,
      "webhookId": "pdpj-assistant"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {
          "frequencyPenalty": 0.1,
          "maxTokens": 2000,
          "presencePenalty": 0.1,
          "temperature": 0.3,
          "topP": 0.9
        }
      },
      "id": "008c9e15-3973-425f-9f4e-524aaeef3c6c",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        520,
        380
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "VQ3UGBDEJ54kzti3",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 8
      },
      "id": "2952b8ae-4bff-4a67-8d50-c2b030aa1f96",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        660,
        400
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "content": "## ‚öôÔ∏è Configura√ß√£o Passo a Passo\n\n### 1. Chat Trigger\n- Path: Autom√°tico\n- Tipo: Internal Chat\n\n### 2. AI Agent\n- Nome: AI Agent Jur√≠dico PDPJ\n- System Message: [Inclu√≠do]\n- Output Parser: Ativado\n\n### 3. OpenAI Model\n- Model: gpt-4o\n- Temperature: 0.3\n- Max Tokens: 2000\n\n### 4. Memory\n- Tipo: Window Buffer\n- Window Size: 10\n\n### 5. Tools\n- Todas apontam para este workflow\n- IDs dos webhooks configurados\n\n### 6. Credenciais\n- CPF: 06293234456\n- Senha: Simb@280303\n- Token Browserless: [Inclu√≠do]",
        "height": 450,
        "width": 300
      },
      "id": "0319ade4-17b2-4204-aeac-a6d089695e85",
      "name": "Guia de Configura√ß√£o",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1360,
        140
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Voc√™ √© um assistente jur√≠dico altamente qualificado, com expertise no sistema PDPJ (Portal de Documentos do Poder Judici√°rio) e em processos judiciais brasileiros. Seu objetivo √© receber pedidos de consulta ou an√°lise processual, disparar as ferramentas corretas para obter dados do PDPJ/PJe e, a partir disso, fornecer respostas completas e coerentes ao usu√°rio.\n\n## Ferramentas Dispon√≠veis\n- **Login_e_ObterTokenLocalStorage_ConsultaPDPJ(numero_processo)**  \n  ‚Üí Faz login no PJe (via Browserless), extrai `access_token` do localStorage e retorna o JSON completo do processo do PDPJ para o n√∫mero informado.\n\n- **listar_documentos_processo(numero_processo)**  \n  ‚Üí Retorna lista de documentos (PDFs, peti√ß√µes, decis√µes) dispon√≠veis para o processo informado.\n\n- **analisar_dados_processo(dados_json_completo)**  \n  ‚Üí Gera insights e recomenda√ß√µes jur√≠dicas com base no JSON completo do processo.\n\n- **buscar_jurisprudencia(termos_de_busca, opcional: filtros)**  \n  ‚Üí Busca jurisprud√™ncias similares a partir de termos jur√≠dicos ou c√≥digo de assunto.\n\n## Suas Responsabilidades\n1. **Identificar a Inten√ß√£o e Par√¢metros**  \n   - Detectar n√∫meros de processo no formato CNJ (20 d√≠gitos ou `NNNNNNN-DD.AAAA.J.TT.OOOO`).  \n   - Distinguir se o usu√°rio quer apenas dados principais, documentos, an√°lise ou jurisprud√™ncia.\n\n2. **Chamar Ferramentas Corretamente**  \n   - Para consulta de processo: use sempre `Login_e_ObterTokenLocalStorage_ConsultaPDPJ(numero_processo)` (ele engloba login e consulta).  \n   - Para listar documentos: use `listar_documentos_processo(numero_processo)` apenas quando solicitado.  \n   - Para an√°lise jur√≠dica: use `analisar_dados_processo(dados_json)` passando o JSON recebido pela consulta.  \n   - Para jurisprud√™ncia: use `buscar_jurisprudencia(termos_de_busca)` se o usu√°rio solicitar precedentes.  \n\n3. **Tratamento de Erros**  \n   - Se a consulta de processo retornar erro (ex.: ‚Äúprocesso n√£o encontrado‚Äù, ‚Äútoken expirado‚Äù), informe de forma clara:  \n     ‚ÄúN√£o foi poss√≠vel consultar o processo [N√öMERO]: [descri√ß√£o do erro].‚Äù  \n   - Se for erro de autentica√ß√£o, sugira que o agente tente novamente (‚ÄúO token do PJe expirou; iniciando novo login.‚Äù).  \n\n4. **Comunica√ß√£o Profissional**  \n   - Use tom formal e respeitoso; adote termos jur√≠dicos corretos.  \n   - Explique eventualmente termos t√©cnicos em linguagem simples.  \n   - Responda de forma direta, mas complete, seguindo sempre a formata√ß√£o abaixo.\n\n## Padr√µes de Formata√ß√£o\n- Use **negrito** para destacar pontos-chave (classe, data, partes).  \n- Dados principais devem vir em lista com marcadores.  \n- Datas no formato DD/MM/AAAA.  \n- Ao citar n√∫mero de processo, inclua o formato completo CNJ (ex.: **0802563-85.2024.8.20.5004**).\n\n### Exemplos de Resposta\n**Consulta de Processo**  \n> ‚ÄúLocalizei o processo **0802563-85.2024.8.20.5004**. Aqui est√£o os dados principais:  \n> - **Classe**: Cumprimento de Senten√ßa  \n> - **Assunto**: A√ß√£o de Cobran√ßa  \n> - **Data de Distribui√ß√£o**: 15/03/2024  \n> - **Valor da Causa**: R$ 12.500,00  \n> - **Partes**:  \n>   - **Autor**: Fulano de Tal  \n>   - **R√©u**: Empresa XYZ S/A  \n> - **√öltima Movimenta√ß√£o**: Decis√£o interlocut√≥ria em 22/05/2025‚Äù\n\n**An√°lise Jur√≠dica**  \n> ‚ÄúCom base na an√°lise do processo **0802563-85.2024.8.20.5004**, observo que:  \n> 1. A contesta√ß√£o ainda n√£o foi apresentada;  \n> 2. O valor da causa est√° compat√≠vel com a jurisprud√™ncia local;  \n> 3. Recomenda-se solicitar bloqueio de bens do r√©u, pois h√° risco de dilapida√ß√£o de patrim√¥nio.‚Äù\n\n**Erro de Token/Autentica√ß√£o**  \n> ‚ÄúN√£o foi poss√≠vel obter o token do PJe. Iniciando novo login. Por favor, tente novamente em alguns segundos.‚Äù\n\n---\n\n### Notas Finais\n- **Sempre** use o JSON retornado pelo sub‚Äêworkflow de consulta como input para a ferramenta `analisar_dados_processo` quando o usu√°rio pedir ‚Äúan√°lise‚Äù.  \n- **Mantenha hist√≥rico**: lembre-se de processos j√° consultados na mesma sess√£o e fa√ßa refer√™ncias se o usu√°rio voltar a mencion√°-los.",
          "returnIntermediateSteps": true
        },
        "promptInputField": "chatInput",
        "sourceForPrompt": "chatInput"
      },
      "id": "04aed12b-d48d-4ddf-96cd-164c1265b13b",
      "name": "AI Agent Jur√≠dico PDPJ",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        660,
        220
      ],
      "typeVersion": 1.7
    },
    {
      "parameters": {
        "name": "analisar_dados_processo",
        "description": "Analisa dados do processo e gera insights jur√≠dicos relevantes",
        "workflowId": "8p1FezK02eglEnXr",
        "fields": {
          "values": [
            {
              "name": "dados_processo",
              "type": "objectValue"
            }
          ]
        }
      },
      "id": "a883c1b8-41d0-4b3a-80f8-360c4174d855",
      "name": "analisar_dados_processo",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        1200,
        240
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "name": "listar_documentos_processo",
        "description": "Lista todos os documentos dispon√≠veis de um processo judicial",
        "workflowId": "R0o48a9gYw9zV55s",
        "fields": {
          "values": [
            {
              "name": "numero_processo"
            }
          ]
        }
      },
      "id": "dbec5862-d892-49d4-8887-d221fde75485",
      "name": "listar_documentos_processo",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        660,
        560
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "name": "realizar_login_pje",
        "description": "Realiza login no sistema PJE para obter token de autentica√ß√£o necess√°rio para consultas na API PDPJ",
        "workflowId": "xzJLyR9yQU08snI3",
        "fields": {
          "values": []
        }
      },
      "id": "83d3e661-b4f3-461f-8510-105472671405",
      "name": "realizar_login_pje",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        1220,
        580
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "name": "consultar_processo_pdpj",
        "description": "Consulta dados completos de um processo judicial no PDPJ usando o n√∫mero do processo",
        "workflowId": "kuun3K58RhwyrdfH",
        "fields": {
          "values": [
            {
              "name": "numero_processo"
            }
          ]
        }
      },
      "id": "f492465e-c808-43a5-844a-cf329275223e",
      "name": "consultar_processo_pdpj",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        1280,
        400
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "name": "buscar_jurisprudencia",
        "description": "Busca jurisprud√™ncia relacionada ao assunto do processo",
        "workflowId": "={{ $workflow.id }}",
        "fields": {
          "values": [
            {
              "name": "termos_busca",
              "type": "string"
            }
          ]
        }
      },
      "id": "1d7eaae5-658d-4295-9cbc-ac2230dd0c36",
      "name": "buscar_jurisprudencia",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        1080,
        520
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "description": "Realiza login no sistema PJE para obter token de autentica√ß√£o necess√°rio para consultas na API PDPJ",
        "workflowId": {
          "__rl": true,
          "value": "xzJLyR9yQU08snI3",
          "mode": "list",
          "cachedResultName": "Login-PJ"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1280,
        500
      ],
      "id": "c3d01b22-3474-439d-a862-8b555e9506ff",
      "name": "Login-PJE"
    },
    {
      "parameters": {
        "description": "Ferramenta que faz login autom√°tico no PJe (TJPE) via Browserless/Puppeteer, extrai o token de acesso (access_token) armazenado em localStorage e executa, em sequ√™ncia, uma requisi√ß√£o √† API do PDPJ para consultar os dados completos de um processo judicial.\n\nO que ela faz:\n1. Navega at√© https://pje.cloud.tjpe.jus.br/1g/login.seam, preenche CPF e senha e efetua login via Keycloak.\n2. Ap√≥s autenticar, acessa https://portaldeservicos.pdpj.jus.br/consulta para que o front-end salve o access_token no localStorage.\n3. L√™ o valor de localStorage.getItem('access_token') e, em seguida, faz um fetch GET para https://portaldeservicos.pdpj.jus.br/api/v2/processos/{numero_processo}, passando Authorization: Bearer <access_token> no cabe√ßalho.\n4. Devolve o JSON completo do processo (classe, partes, movimenta√ß√µes, valores, etc.) para o fluxo pai.\n\nPar√¢metro obrigat√≥rio:\n- numero_processo (string): n√∫mero do processo judicial no formato CNJ (20 d√≠gitos ou NNNNNNN-DD.AAAA.J.TT.OOOO).\n\nRetorno:\n- Em caso de sucesso: todo o objeto JSON com os dados do processo (campo dados_processo).\n- Em caso de falha: objeto { \"success\": false, \"error\": \"<mensagem de erro detalhada>\" }, que ser√° transformado em erro no n√≥ seguinte.\n\nQuando usar:\nSempre que o usu√°rio solicitar consulta de um processo no chat, para garantir que o login e a chamada √† API sejam feitos de forma segura e unificada, sem necessidade de interven√ß√µes manuais.",
        "workflowId": {
          "__rl": true,
          "value": "kqp62gO6DyoNRXKq",
          "mode": "list",
          "cachedResultName": "Login_e_ObterToken_ConsultaPDPJ"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "numero_processo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('numero_processo', ``, 'string') }}"
          },
          "matchingColumns": [
            "numero_processo"
          ],
          "schema": [
            {
              "id": "numero_processo",
              "displayName": "numero_processo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        860,
        540
      ],
      "id": "7c7f4d27-42d5-4159-bd12-7a58d2ee2217",
      "name": "Login_e_ObterToken_ConsultaPDPJ"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent Jur√≠dico PDPJ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Jur√≠dico PDPJ",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent Jur√≠dico PDPJ",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "analisar_dados_processo": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Jur√≠dico PDPJ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "realizar_login_pje": {
      "ai_tool": [
        []
      ]
    },
    "consultar_processo_pdpj": {
      "ai_tool": [
        []
      ]
    },
    "buscar_jurisprudencia": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Jur√≠dico PDPJ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "listar_documentos_processo": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Jur√≠dico PDPJ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Login-PJE": {
      "ai_tool": [
        []
      ]
    },
    "Login_e_ObterToken_ConsultaPDPJ": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Jur√≠dico PDPJ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "e05a2673-89bd-401f-9660-7aa7c671ef0a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9601c2da077393e3c7d395982728b7744de7ac7dd087f4789f3781b83e316e6e"
  },
  "id": "CbttoGhOBF53R0D1",
  "tags": []
}
